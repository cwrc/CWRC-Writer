<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <title>CWRC-Writer</title>
        
        <link type="text/css" rel="stylesheet" href="css/style.css" />
        <link type="text/css" rel="stylesheet" href="css/layout-default-latest.css" />
        <link type="text/css" rel="stylesheet" href="css/cwrcstyle/jquery-ui.css" />
        <link type="text/css" rel="stylesheet" href="lib/cwrc/css/cD.css" />
        
        <script type="text/javascript" src ="lib/jquery/jquery.js"></script>
        <script type="text/javascript" src ="lib/jquery/jquery-ui.js"></script>
        <script type="text/javascript" src ="lib/jquery/plugins.js"></script>
        <script type="text/javascript" src ="lib/tinymce/tinymce.js"></script>
        <script type="text/javascript" src ="lib/tinymce/plugins.js"></script>
    </head>
	<body>
		<div id="cwrc_wrapper">
		    <div id="cwrc_main" class="ui-layout-center">
		        <div class="ui-layout-center">
		            <form method="post" action="">
		                <textarea id="editor" name="editor" class="tinymce"></textarea>
		            </form>
		        </div>
		    </div>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript" src="js/delegator.js"></script>
		<script type="text/javascript" src ="lib/cwrc/cD.js"></script>
		<script type="text/javascript">
            function doInit(config) {
                config.delegator = Delegator;
                config.mode = 'xml';
                //config.buttons1 = 'schematags,editTag,removeTag,|,addperson,addplace,adddate,addorg,addtitle,addcorrection,addlink';
                writer = new CWRCWriter(config);
                writer.init('editor');
                //writer.event('writerInitialized').subscribe(doResize);
                //$(window).on('resize', doResize);
                
                writer.event('writerInitialized').subscribe(function(writer) {
                    writer.fileManager.loadInitialDocument(window.location.hash);
                    /*
                    require(['modules/entitiesList', 'modules/structureTree', 'modules/validation'
                    ], function(EntitiesList, StructureTree, Validation) {
                        setupLayoutAndModules(writer, EntitiesList, StructureTree, Validation);
                    });*/
                });
            }
            
            (function() {
                var configXHR = $.ajax({url: 'js/writerConfig.js', dataType: 'json'});
                var projectXHR = $.ajax({url: 'http://apps.testing.cwrc.ca/editor/documents/info/projectname'});
                $.when(
                    configXHR,
                    projectXHR
                ).then(function(config, project) {
                    config = config[0];
                    project = project[0];
                    config.project = project;
                    config.cwrcRootUrl = window.location.protocol+'//'+window.location.host+window.location.pathname.replace(window.location.pathname.split('/').pop(),'');
                    doInit(config);
                },function(xhr) {
                    if (configXHR.state() === 'resolved') {
                        var config = $.parseJSON(configXHR.responseText);
                        config.cwrcRootUrl = window.location.protocol+'//'+window.location.host+window.location.pathname.replace(window.location.pathname.split('/').pop(),'');
                        doInit(config);
                    } else {
                        alert('Error loading writerConfig.js');
                    }
                });
            }());
        </script>
	</body>
</html>