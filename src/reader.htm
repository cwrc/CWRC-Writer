<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <title>CWRC-Reader</title>
        
        <link type="text/css" rel="stylesheet" href="css/style.css" />
        <link type="text/css" rel="stylesheet" href="css/layout-default-latest.css" />
        <link type="text/css" rel="stylesheet" href="css/cwrc12/jquery-ui.css" />
    </head>
    <body>
        <script type="text/javascript" src="js/app.js"></script>
        <script type="text/javascript" src="js/delegator.js"></script>
        <script type="text/javascript">
            function doInit(config) {
                config.delegator = Delegator;
                config.mode = 'rdf';
                config.readonly = true;
                config.buttons1 = 'addperson,addplace,adddate,addorg,addcitation,addnote,addtitle,addcorrection,addkeyword,addlink,|,addtriple,|,savebutton,loadbutton';
                config.buttons2 = '';
                writer = new CWRCWriter(config);
                writer.init('cwrcWriterContainer');
                writer.fileManager.loadInitialDocument(window.location.hash);
            }
            
            (function() {
                var configXHR = $.ajax({url: 'js/writerConfig.js', dataType: 'json'});
                var projectXHR = $.ajax({url: 'http://apps.testing.cwrc.ca/editor/documents/info/projectname'});
                $.when(
                    configXHR,
                    projectXHR
                ).then(function(config, project) {
                    config = config[0];
                    project = project[0];
                    config.project = project;
                    config.cwrcRootUrl = window.location.protocol+'//'+window.location.host+window.location.pathname.replace(window.location.pathname.split('/').pop(),'');
                    doInit(config);
                },function(xhr) {
                    if (configXHR.state() === 'resolved') {
                        var config = $.parseJSON(configXHR.responseText);
                        config.cwrcRootUrl = window.location.protocol+'//'+window.location.host+window.location.pathname.replace(window.location.pathname.split('/').pop(),'');
                        doInit(config);
                    } else {
                        alert('Error loading writerConfig.js');
                    }
                });
            }());
        </script>
        <div id="cwrcWriterContainer" style="height: 100%; width: 100%;"></div>
    </body>
</html>